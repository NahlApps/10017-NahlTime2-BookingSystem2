<!DOCTYPE html>
<html lang="ar" dir="rtl" data-lang-default="ar">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

  <title data-i18n="meta.title">ุญุฌูุฒุงุช ุงูููุงุนูุฏ</title>

  <!-- โ PWA Manifest (relative path for subfolder) -->
  <link rel="manifest" href="manifest.webmanifest">
  
  <!-- Browser / Taskbar color -->
  <meta name="theme-color" content="#01657A">

  <!-- ๐น Favicon -->
  <link rel="icon" type="image/png" sizes="32x32"
        href="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/NahlTimePro/towel_logo_clean@3x.png" />
  <link rel="shortcut icon"
        href="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/NahlTimePro/towel_logo_clean@3x.png" />
  <link rel="apple-touch-icon"
        href="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/NahlTimePro/towel_logo_clean@3x.png" />

  <!-- UI libs -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/css/intlTelInput.css" rel="stylesheet"/>

  <!-- iOS PWA support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="NahlTime">
  <link rel="apple-touch-icon"
        href="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/NahlTimePro/towel_logo_clean@3x.png">

  <!-- Main app styles -->
  <link rel="stylesheet" href="style.css">

  <!-- Small style for language toggle button -->
  <style>
    .lang-toggle-btn {
      border: 1px solid rgba(255,255,255,0.6);
      background: rgba(0,0,0,0.12);
      color: #fff;
      border-radius: 999px;
      padding: 6px 10px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      cursor: pointer;
      backdrop-filter: blur(6px);
    }
    .lang-toggle-btn i {
      font-size: 14px;
    }
    .lang-toggle-btn:hover {
      background: rgba(0,0,0,0.25);
    }
  </style>
</head>
<body>
  <!-- ๐ Toast container -->
  <div id="toastWrap"
       style="position:fixed;top:10px;left:50%;transform:translateX(-50%);
              z-index:1050;display:flex;flex-direction:column;gap:8px"></div>

  <!-- ========================= -->
  <!--  Header                   -->
  <!-- ========================= -->
  <header id="siteHeader">
    <div class="header-inner">
      <div class="brand">
        <img id="brandLogo"
             alt="Nahl Time"
             data-i18n-alt="header.logoAlt"
             src="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/NahlTimePro/towel_logo_clean@3x.png"
             onerror="handleLogoError(this)" />
      </div>

      <div class="header-right">
        <!-- ๐ Language toggle (user icon) -->
        <button id="langToggleBtn"
                type="button"
                class="lang-toggle-btn"
                aria-label="Change language / ุชุบููุฑ ุงููุบุฉ"
                title="ุชุบููุฑ ุงููุบุฉ"
                data-i18n-title="header.langToggleTitle"
                data-i18n-aria-label="header.langToggleAria">
          <i class="fa-regular fa-user"></i>
          <span id="langToggleLabel">ุน</span>
        </button>

        <div class="mini-progress" aria-hidden="true">
          <div class="bar"><span id="miniBarFill" style="width:0%"></span></div>
          <div class="step" id="miniStepTitle" data-i18n="header.stepWelcome">ุงูุชุฑุญูุจ</div>
        </div>
        <div id="summaryChips" class="summary-chips" aria-live="polite"></div>
      </div>
    </div>
  </header>

  <!-- ========================= -->
  <!--  Main App                 -->
  <!-- ========================= -->
  <main>
    <div id="app">
      <div class="stage">
        <!-- 1) Welcome -->
        <section id="page1" class="page active"
                 aria-label="ุงูุชุฑุญูุจ"
                 data-i18n-aria-label="page1.ariaLabel">
          <h1 data-i18n="page1.title">โจ ุบุณูู ุจุฏูู ุทูุงุจูุฑ</h1>

          <div id="pptDeck" class="ppt-deck">
            <div class="ppt-slide is-active">
              <div class="slide-card">
                <h3 class="mb-2" data-i18n="page1.slide1.title">ูุฌูู ููู ุจุงุจ ุจูุชู</h3>
                <p class="m-0" data-i18n="page1.slide1.body">ุญุฌุฒ ุณุฑูุน โข ุฎุฏูุฉ ูุชูููุฉ โข ุงุญุชุฑุงููุฉ ูู ูู ุชูุตูู</p>
              </div>
            </div>
            <div class="ppt-slide">
              <div class="slide-card">
                <h3 class="mb-2" data-i18n="page1.slide2.title">ููุงุฏ ูุงุฎุฑุฉ</h3>
                <p class="m-0" data-i18n="page1.slide2.body">ููุชุฌุงุช ุขููุฉ ุนูู ุงูุทูุงุก ูุงูุฏุงุฎููุฉ ูุน ุนูุงูุฉ ุฏูููุฉ</p>
              </div>
            </div>
            <div class="ppt-slide">
              <div class="slide-card">
                <h3 class="mb-2" data-i18n="page1.slide3.title">ููุนุฏู ุนูู ุฑุงุญุชู</h3>
                <p class="m-0" data-i18n="page1.slide3.body">ุญุฏุฏ ุงูููุทูุฉ ูุงูุฎุฏูุฉ ูุงูููุช ุงูููุงุณุจ โ ูุงูุจุงูู ุนูููุง</p>
              </div>
            </div>
          </div>
          <div id="pptDots" class="ppt-dots" aria-hidden="true"></div>

          <!-- ๐ ุนุฑูุถ ุงูููู (ุฒุฑ ููุชุญ ุงูุจูุจ ุฃุจ) -->
          <div class="mt-3" style="display:flex;justify-content:center;">
            <button id="btnShowOffers"
                    type="button"
                    class="btn-offers-pill"
                    data-i18n="page1.offersButton">
              <i class="fa-solid fa-gift"></i>
              <span>ุนุฑูุถ ุงูููู</span>
            </button>
          </div>

          <div class="card text-center" style="max-width:860px">
            <p class="mb-0" style="color:#224652"
               data-i18n="page1.nextHint">
              ุงูุทูู โ ุงูุฎุทูุฉ ุงูุชุงููุฉ ูุงุฎุชูุงุฑ ุงูููุทูุฉ ูุงูุฎุฏูุฉ
            </p>
          </div>
        </section>

        <!-- 2) Service & Location (+ Additional services + Gift toggle) -->
        <section id="page2" class="page"
                 aria-label="ุงุฎุชูุงุฑ ุงูููุทูุฉ ูุงูุฎุฏูุฉ"
                 data-i18n-aria-label="page2.ariaLabel">
          <h1 data-i18n="page2.title">ููู ุชุญุจ ูุฌููุ</h1>

          <div class="card position-relative" id="servicesCard">
            <label class="form-label" data-i18n="page2.areaLabel">ุงุฎุชูุงุฑ ุงูููุทูุฉ</label>
            <select id="area" style="width:100%"></select>
            <div class="field-error" id="err-area" data-i18n="errors.area">ูุฑุฌู ุงุฎุชูุงุฑ ุงูููุทูุฉ</div>

            <div class="row g-3 mt-3">
              <div class="col-12 col-md-6">
                <label class="form-label" data-i18n="page2.categoryLabel">ุงูุชุตููู</label>
                <select id="serviceCat" style="width:100%"></select>
                <div class="field-error" id="err-serviceCat" data-i18n="errors.serviceCat">ูุฑุฌู ุงุฎุชูุงุฑ ุงูุชุตููู</div>
              </div>
              <div class="col-12 col-md-6">
                <label class="form-label" data-i18n="page2.serviceLabel">ุงูุฎุฏูุฉ</label>
                <select id="service" style="width:100%"></select>
                <div class="field-error" id="err-service" data-i18n="errors.service">ูุฑุฌู ุงุฎุชูุงุฑ ุงูุฎุฏูุฉ</div>
              </div>

              <div class="col-12">
                <label class="form-label" id="serviceDetailsLabel" data-i18n="page2.serviceDetailsLabel">ุชูุงุตูู ุงูุฎุฏูุฉ</label>
                <div id="serviceDetails"
                     class="small text-muted bg-white border rounded-3 p-3"
                     style="border-radius:14px;"
                     data-i18n="page2.serviceDetailsPlaceholder">
                  ุณูุชู ุนุฑุถ ุชูุงุตูู ุงูุฎุฏูุฉ ุงููุฎุชุงุฑุฉ ููุง.
                </div>
              </div>

              <div class="col-12">
                <label class="form-label" id="servicePriceLabel" data-i18n="page2.servicePriceLabel">ุณุนุฑ ุงูุฎุฏูุฉ (ุดุงูู ุงูุถุฑูุจุฉ)</label>
                <div id="servicePrice"
                     class="small bg-white border rounded-3 p-3 fw-bold text-primary"
                     style="border-radius:14px;">
                  โ
                </div>
              </div>

              <div class="col-12">
                <label class="form-label" data-i18n="page2.countLabel">ุนุฏุฏ ุงูุณูุงุฑุงุช</label>
                <select id="serviceCount" class="form-select">
                  <option value="1" selected>1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                </select>
              </div>
            </div>

            <!-- ๐ Additional Services UI (ุฃุนูู ูู ุงููุฏูุฉ ุงูุขู) -->
            <hr class="mt-4 mb-3"/>
            <div class="mt-2">
              <label class="form-label" data-i18n="page2.additionalLabel">ุฎุฏูุงุช ุฅุถุงููุฉ (ุงุฎุชูุงุฑู)</label>
              <div id="additionalServicesWrap">
                <div class="text-muted small" data-i18n="page2.additionalLoading">ุฌุงุฑู ุชุญููู ุงูุฎุฏูุงุช ุงูุฅุถุงููุฉโฆ</div>
              </div>
              <div class="field-error" id="err-additionalServices" style="display:none"></div>
            </div>

            <!-- ๐ Gift toggle -->
            <hr class="mt-4 mb-3"/>
            <div class="mt-2">
              <label class="form-label" data-i18n="page2.giftLabel">ูู ุชุฑุบุจ ุจุฅุฑุณุงู ุงูุฎุฏูุฉ ูู ูุฏูุฉุ</label>
              <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" role="switch" id="isGiftToggle">
                  <label class="form-check-label"
                         for="isGiftToggle"
                         data-i18n="page2.giftToggleText">
                    ูุนูุ ุฃุฑูุฏ ุฅุฑุณุงููุง ููุฏูุฉ ูุตุฏูู
                  </label>
                </div>
                <small class="text-muted"
                       data-i18n="page2.giftHint">
                  ุนูุฏ ุงุฎุชูุงุฑ ุงููุฏูุฉุ ูุณุชูู ุจูุงูุงุชู ูุจูุงูุงุช ุงููุณุชููุ ูุชุตู ูู ุฑุณุงูุฉ ุฎุงุตุฉ ูุน ุฑุงุจุท ุงูุญุฌุฒ ูููุจูู ุงููุฏูุฉ.
                </small>
              </div>
            </div>

            <div id="servicesLoading" class="load-overlay" aria-hidden="true">
              <div class="spinner-border text-info" role="status" aria-hidden="true"></div>
              <strong data-i18n="loading.services">ุฌุงุฑู ุชุญููู ุงูุฎุฏูุงุชโฆ</strong>
            </div>
          </div>
        </section>

        <!-- 3) Time (normal booking only; skipped for gift) -->
        <section id="page3" class="page"
                 aria-label="ุงุฎุชูุงุฑ ุงูููุนุฏ"
                 data-i18n-aria-label="page3.ariaLabel">
          <h1 data-i18n="page3.title">ูุชู ุชุญุจ ูุฌููุ</h1>
          <div class="card position-relative" id="timeCard">
            <div class="row g-3">
              <div class="col-12 col-md-5">
                <label class="form-label" for="date" data-i18n="page3.dateLabel">ุงูุชุงุฑูุฎ</label>
                <input id="date"
                       type="date"
                       class="form-control"/>
                <div class="field-error" id="err-date" data-i18n="errors.date">ูุฑุฌู ุงุฎุชูุงุฑ ุชุงุฑูุฎ ุตุญูุญ</div>
              </div>
            </div>

            <div class="time-toolbar mt-3">
              <div>
                <label class="form-label" for="timeFilter" data-i18n="page3.timeFilterLabel">ููุชุฑุฉ ุงูููุช</label>
                <select id="timeFilter" class="form-select">
                  <option value="all" selected data-i18n="page3.timeFilter.all">ูู ุงูุฃููุงุช ุงููุชุงุญุฉ</option>
                  <option value="morning" data-i18n="page3.timeFilter.morning">ุงูุตุจุงุญ (06:00โ11:00)</option>
                  <option value="afternoon" data-i18n="page3.timeFilter.afternoon">ุงูุธููุฑุฉ (11:00โ16:00)</option>
                  <option value="evening" data-i18n="page3.timeFilter.evening">ุงููุณุงุก (16:00โ21:00)</option>
                  <option value="night" data-i18n="page3.timeFilter.night">ููููุง (21:00โ23:59)</option>
                </select>
              </div>
            </div>

            <div class="position-relative mt-3">
              <div id="time-container"
                   class="time-grid"
                   role="radiogroup"
                   aria-label="ุงุฎุชูุงุฑ ุงูููุช"
                   data-i18n-aria-label="page3.timeGroupAria"></div>
              <div id="timeLoading" class="load-overlay">
                <div class="spinner-border text-info" role="status" aria-hidden="true"></div>
                <strong data-i18n="loading.times">ุฌุงุฑู ุฌูุจ ุงูููุงุนูุฏโฆ</strong>
              </div>
            </div>
          </div>
        </section>

        <!-- 4) Contact (Sender) + Gift Receiver -->
        <section id="page4" class="page"
                 aria-label="ูุนูููุงุช ุงูุงุชุตุงู"
                 data-i18n-aria-label="page4.ariaLabel">
          <h1 data-i18n="page4.title">ูุนูููุงุช ุงูุงุชุตุงู</h1>

          <!-- Sender info (ุงูููุฑุณูู) -->
          <div class="card">
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label for="name" class="form-label" data-i18n="page4.nameLabel">ุงูุงุณู</label>
                <input id="name"
                       type="text"
                       class="form-control"
                       placeholder="ุงูุงุณู ููุง ุณูุธูุฑ ูู ุงููุงุชูุฑุฉ"
                       autocomplete="name"
                       data-i18n-placeholder="page4.namePlaceholder"/>
                <div class="field-error" id="err-name" data-i18n="errors.name">ูุฑุฌู ุฅุฏุฎุงู ุงูุงุณู</div>
              </div>
              <div class="col-12 col-md-6">
                <label for="mobile" class="form-label" data-i18n="page4.mobileLabel">ุฑูู ุงูุฌูุงู</label>
                <input id="mobile"
                       type="tel"
                       class="form-control"
                       placeholder="ุฑูู ุงูุชูุงุตู ุงูุฎุงุต โ ูุซุงู 5XXXXXXXX"
                       autocomplete="tel"
                       data-i18n-placeholder="page4.mobilePlaceholder"/>
                <div class="field-error" id="err-mobile" data-i18n="errors.mobile">ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฑูู ุฌูุงู ุตุญูุญ</div>

                <!-- ๐ OTP Controls (send + status) -->
                <div class="d-flex flex-wrap align-items-center gap-2 mt-2"
                     id="otpControls"
                     style="display:none;">
                  <button id="btnSendOtp"
                          type="button"
                          class="btn btn-sm btn-outline-primary"
                          style="border-radius:999px; min-height:38px;"
                          data-i18n="page4.otpSendBtn">
                    ุฅุฑุณุงู ููุฏ ุนูู ูุงุชุณุงุจ
                  </button>
                  <span id="otpStatus"
                        class="small text-muted"
                        data-i18n="page4.otpStatus">
                    ุณูุชู ุฅุฑุณุงู ููุฏ ูู 4 ุฃุฑูุงู ููุชุญูู ูู ุฑููู ุนุจุฑ ูุงุชุณุงุจ.
                  </span>
                </div>

                <!-- ๐ข OTP Input + Verify -->
                <div class="row g-2 mt-2" id="otpVerifyRow" style="display:none;">
                  <div class="col-8 col-sm-6">
                    <input id="otpCode"
                           type="tel"
                           inputmode="numeric"
                           maxlength="4"
                           class="form-control"
                           placeholder="ุฃุฏุฎู ููุฏ ุงูุชุญูู (4 ุฃุฑูุงู)"
                           data-i18n-placeholder="page4.otpPlaceholder"/>
                  </div>
                  <div class="col-4 col-sm-3 d-grid">
                    <button id="btnVerifyOtp"
                            type="button"
                            class="btn btn-success btn-sm"
                            style="min-height:40px;"
                            data-i18n="page4.otpVerifyBtn">
                      ุชุฃููุฏ
                    </button>
                  </div>
                </div>
                <div class="field-error" id="err-otp" style="display:none;" data-i18n="errors.otp">
                  ูุฑุฌู ุฅุฏุฎุงู ููุฏ ุงูุชุญูู ุงูุตุญูุญ
                </div>
              </div>
            </div>
          </div>

          <!-- ๐ Gift receiver info (only used when isGiftToggle is ON) -->
          <div class="card mt-3" id="giftReceiverCard" style="display:none;">
            <h2 class="h5 mb-3" style="font-weight:800;" data-i18n="gift.title">ุจูุงูุงุช ุงููุณุชูู (ุงููุฏูุฉ)</h2>
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label for="giftReceiverName" class="form-label" data-i18n="gift.nameLabel">ุงุณู ุงููุณุชูู</label>
                <input id="giftReceiverName"
                       type="text"
                       class="form-control"
                       placeholder="ุงุณู ุงูุดุฎุต ุงูุฐู ุณุชุตู ูู ุงููุฏูุฉ"
                       autocomplete="off"
                       data-i18n-placeholder="gift.namePlaceholder"/>
                <div class="field-error" id="err-giftReceiverName" style="display:none;" data-i18n="errors.giftName">
                  ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงููุณุชูู
                </div>
              </div>
              <div class="col-12 col-md-6">
                <label for="giftReceiverMobile" class="form-label" data-i18n="gift.mobileLabel">ุฌูุงู ุงููุณุชูู</label>
                <div class="input-group">
                  <select id="giftReceiverCountry" class="form-select" style="max-width:140px;">
                    <option value="966" selected>+966 ุงูุณุนูุฏูุฉ</option>
                    <option value="971">+971 ุงูุฅูุงุฑุงุช</option>
                    <option value="973">+973 ุงูุจุญุฑูู</option>
                    <option value="974">+974 ูุทุฑ</option>
                    <option value="965">+965 ุงููููุช</option>
                    <option value="968">+968 ุนููุงู</option>
                  </select>
                  <input id="giftReceiverMobile"
                         type="tel"
                         class="form-control"
                         placeholder="5XXXXXXXX"
                         autocomplete="off"
                         data-i18n-placeholder="gift.mobilePlaceholder"/>
                </div>
                <small class="text-muted d-block mt-1" data-i18n="gift.mobileHint">
                  ุณูุชู ุฅุฑุณุงู ุงููุฏูุฉ ููุฐุง ุงูุฑูู ุนุจุฑ ูุงุชุณุงุจ.
                </small>
                <div class="field-error" id="err-giftReceiverMobile" style="display:none;" data-i18n="errors.giftMobile">
                  ูุฑุฌู ุฅุฏุฎุงู ุฌูุงู ุงููุณุชูู
                </div>
              </div>
              <div class="col-12">
                <label for="giftMessage" class="form-label" data-i18n="gift.messageLabel">ุฑุณุงูุฉ ูุฑุงููุฉ ูููุฏูุฉ (ุงุฎุชูุงุฑู)</label>
                <textarea id="giftMessage"
                          rows="3"
                          class="form-control"
                          placeholder="ุฃูุชุจ ุฑุณุงูุฉ ูุทููุฉ ุชุธูุฑ ูููุณุชูู ูุน ุฑุงุจุท ุงูุญุฌุฒ ูููุจูู ุงููุฏูุฉ"
                          data-i18n-placeholder="gift.messagePlaceholder"></textarea>
              </div>
            </div>
          </div>

          <!-- ๐ Car Info section (hidden in gift mode via JS) -->
          <section id="carInfoSection"
                   aria-label="ูุนูููุงุช ุงููุฑูุจุฉ"
                   data-i18n-aria-label="page4.carAria">
            <h1 class="mt-4" data-i18n="car.title">ูุนูููุงุช ุงููุฑูุจุฉ</h1>
            <div class="card">
              <div class="row g-3">
                <div class="col-12 col-md-4">
                  <label class="form-label" for="carBrand" data-i18n="car.brandLabel">ูุงุฑูุฉ ุงูุณูุงุฑุฉ ๐</label>
                  <select id="carBrand" style="width:100%"></select>
                </div>
                <div class="col-12 col-md-4">
                  <label class="form-label" for="carName" data-i18n="car.nameLabel">ุงุณู ุงูุณูุงุฑุฉ</label>
                  <input id="carName"
                         type="text"
                         class="form-control"
                         placeholder="ุงูููุฏูู/ุงููุฆุฉ โ ูุซุงู: S-Classุ LX 570"
                         autocomplete="off"
                         data-i18n-placeholder="car.namePlaceholder"/>
                </div>
                <div class="col-12 col-md-4">
                  <label class="form-label" for="plateNumber" data-i18n="car.plateLabel">ุฑูู ุงูููุญุฉ (ุงุฎุชูุงุฑู)</label>
                  <input id="plateNumber"
                         type="text"
                         inputmode="numeric"
                         class="form-control"
                         placeholder="ุฃุฑูุงู ุงูููุญุฉ โ ุงุฎุชูุงุฑู"
                         autocomplete="off"
                         data-i18n-placeholder="car.platePlaceholder"/>
                  <small id="plateHelp"
                         class="text-muted d-block mt-1"
                         style="opacity:.9"
                         data-i18n="car.plateHint">
                    ุงุฎุชูุงุฑู โ ูุณุงุนุฏ ูุฑูููุง ุนูู ุงูุชุนุฑู ุนูู ูุฑูุจุชู ุจุณุฑุนุฉ
                  </small>
                  <div class="field-error" id="err-plate" style="display:none"></div>
                </div>
                <input id="locationDescription" type="text" hidden/>
              </div>
            </div>
          </section>
        </section>

        <!-- 5) Payment + Coupon -->
        <section id="page5" class="page"
                 aria-label="ุทุฑููุฉ ุงูุฏูุน"
                 data-i18n-aria-label="page5.ariaLabel">
          <h1 data-i18n="page5.title">ุทุฑููุฉ ุงูุฏูุน</h1>

          <!-- Dynamic payment methods will be injected here -->
          <div class="pay-grid"
               role="radiogroup"
               aria-label="ุทุฑููุฉ ุงูุฏูุน"
               id="payGroup"
               data-i18n-aria-label="page5.payGroupAria"></div>
          <div class="field-error"
               id="err-pay"
               style="text-align:center"
               data-i18n="errors.pay">
            ูุฑุฌู ุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุฏูุน
          </div>

          <!-- Coupon block -->
          <div class="card mt-4" id="couponCard">
            <label for="couponCode" class="form-label" data-i18n="coupon.label">ููุฏ ุงูุฎุตู (ุงุฎุชูุงุฑู)</label>
            <div class="input-group">
              <input id="couponCode"
                     type="text"
                     class="form-control"
                     placeholder="ูุซุงู: WELCOME10"
                     autocomplete="off"
                     data-i18n-placeholder="coupon.placeholder"/>
              <button id="applyCouponBtn"
                      type="button"
                      class="btn btn-outline-primary"
                      style="min-width:120px"
                      data-i18n="coupon.applyBtn">
                ุชุทุจูู ุงูููุจูู
              </button>
            </div>
            <div id="couponMessage"
                 class="small mt-2 text-muted"
                 data-i18n="coupon.message">
              ููููู ุฅุฏุฎุงู ููุจูู ุฎุตู ุฅู ูุฌุฏุ ูุณูุชู ุชุทุจููู ุนูู ุฅุฌูุงูู ุงูุทูุจ.
            </div>
          </div>
        </section>

        <!-- 6) Map (normal booking only; gift skips location) -->
        <section id="page6" class="page"
                 aria-label="ุงุฎุชูุงุฑ ุงููููุน"
                 data-i18n-aria-label="page6.ariaLabel">
          <h1 data-i18n="page6.title">ุงููููุน ุนูู ุฎุฑูุทุฉ ูููู</h1>
          <div class="card">
            <div class="map-search">
              <input id="mapSearch"
                     class="form-control"
                     type="text"
                     placeholder="ุงุจุญุซ ุนู ุจุฑุฌุ ุญูุ ุฃู ุนููุงู ุฏุงุฎู ุงูุณุนูุฏูุฉ"
                     data-i18n-placeholder="page6.mapPlaceholder"/>
              <i class="fa-solid fa-magnifying-glass"></i>
            </div>
            <div id="googleMap"></div>
            <!-- ๐ Hidden fields to store map coordinates -->
            <input type="hidden" id="locationLat">
            <input type="hidden" id="locationLng">
          </div>

          <!-- ุงูุฒุฑ ุงููุฏูู ุณูุชู ุฅุฎูุงุคู ูู app.js (ูุณุชุฎุฏู ุฃููููุฉ ๐ ุฏุงุฎู ุงูุฎุฑูุทุฉ) -->
          <div class="card text-center">
            <button id="show-my-location"
                    class="btn btn-outline-primary"
                    type="button"
                    data-i18n="page6.showMyLocation">
              ุฅุธูุงุฑ ูููุนู
            </button>
          </div>

          <small id="mapHint"
                 class="text-muted d-block mt-2"
                 style="text-align:center"
                 data-i18n="page6.hint">
            ุงุถุบุท ุนูู ุงูุฎุฑูุทุฉ ููุถุน ุงูุฏุจูุณุ ุงุณุญุจ ุงูุฏุจูุณ ูุชุนุฏูู ุงูููุงูุ ุฃู ุงุณุชุฎุฏู ุฒุฑ <strong>๐</strong> ุฏุงุฎู ุงูุฎุฑูุทุฉ ูุชุญุฏูุฏ ูููุนู ุงูุญุงูู.
          </small>
          <div class="field-error"
               id="err-map"
               style="text-align:center"
               data-i18n="errors.map">
            ุงูุฑุฌุงุก ุชุญุฏูุฏ ุงููููุน ุนูู ุงูุฎุฑูุทุฉ
          </div>
        </section>

        <!-- 7) Done -->
        <section id="page7" class="page"
                 aria-label="ุชู ุงูุญุฌุฒ"
                 data-i18n-aria-label="page7.ariaLabel">
          <h1 data-i18n="page7.title">ุดูุฑุงู ููู ๐</h1>
          <div class="card text-center" style="max-width:720px">
            <p class="mb-3" style="color:#224652" data-i18n="page7.subtitle">
              ุชู ุงุณุชูุงู ุทูุจููุ ูุณูุคูุฏ ุงูููุนุฏ ุนูู ูุงุชุณุงุจ ูุฑูุจูุง.
            </p>

            <div id="thanks-summary" class="text-start mx-auto" style="max-width:520px">
              <div class="d-flex justify-content-between py-2 border-bottom">
                <span data-i18n="summary.area">ุงูููุทูุฉ</span><strong id="ts-area">โ</strong>
              </div>
              <div class="d-flex justify-content-between py-2 border-bottom">
                <span data-i18n="summary.service">ุงูุฎุฏูุฉ</span><strong id="ts-service">โ</strong>
              </div>
              <div class="d-flex justify-content-between py-2 border-bottom">
                <span data-i18n="summary.datetime">ุงูููุนุฏ</span><strong id="ts-dt">โ</strong>
              </div>
              <div class="d-flex justify-content-between py-2">
                <span data-i18n="summary.payMethod">ุทุฑููุฉ ุงูุฏูุน</span><strong id="ts-pay">โ</strong>
              </div>
            </div>

            <div class="d-flex gap-2 justify-content-center mt-3 flex-wrap">
              <a id="ts-whatsapp"
                 class="btn btn-success"
                 target="_blank"
                 rel="noopener"
                 data-i18n="page7.shareWhatsapp">
                <i class="fa-brands fa-whatsapp"></i> ูุดุงุฑูุฉ ุนุจุฑ ูุงุชุณุงุจ
              </a>
              <button id="rebook"
                      class="btn btn-primary"
                      type="button"
                      style="min-height:52px;font-weight:800;border-radius:12px;padding:12px 18px"
                      data-i18n="page7.rebookBtn">
                ๐ ุญุฌุฒ ุฌุฏูุฏ
              </button>
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- ๐ Offers Modal Markup -->
  <div id="offersModal" class="offers-modal" aria-hidden="true">
    <div class="offers-backdrop"></div>
    <div class="offers-dialog" role="dialog" aria-modal="true" aria-labelledby="offersTitle">
      <div class="offers-header">
        <h2 id="offersTitle" class="offers-title" data-i18n="offers.title">ุนุฑูุถ ุงูููู</h2>
        <button type="button"
                class="offers-close"
                aria-label="ุฅุบูุงู ุงูุนุฑูุถ"
                data-i18n-aria-label="offers.closeAria">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      <div id="offersFilters" class="offers-filters">
        <button type="button"
                class="offers-filter-chip active"
                data-type="all"
                data-i18n="offers.filterAll">
          ุงููู
        </button>
        <button type="button"
                class="offers-filter-chip active"
                data-type="image"
                data-i18n="offers.filterImage">
          ุตูุฑ
        </button>
        <button type="button"
                class="offers-filter-chip active"
                data-type="text"
                data-i18n="offers.filterText">
          ูุตูุต
        </button>
        <button type="button"
                class="offers-filter-chip active"
                data-type="coupon"
                data-i18n="offers.filterCoupon">
          ููุจููุงุช
        </button>
      </div>
      <div id="offersList" class="offers-list">
        <div class="offers-empty text-muted small" data-i18n="offers.loading">ุฌุงุฑู ุชุญููู ุงูุนุฑูุถโฆ</div>
      </div>
    </div>
  </div>

  <!-- ๐ Terms & Conditions Modal (dynamic from Google Sheet via js/terms-modal.js) -->
  <div id="termsModal"
       class="offers-modal"
       aria-hidden="true"
       data-terms-app-id="21eddbf5-efe5-4a5d-9134-b581717b17ff">
    <div class="offers-backdrop"></div>
    <div class="offers-dialog" role="dialog" aria-modal="true" aria-labelledby="termsTitle">
      <div class="offers-header">
        <h2 id="termsTitle" class="offers-title" data-i18n="terms.title">ุงูุดุฑูุท ูุงูุฃุญูุงู</h2>
        <button type="button"
                class="offers-close"
                data-terms-dismiss="1"
                aria-label="ุฅุบูุงู ุงูุดุฑูุท"
                data-i18n-aria-label="terms.closeAria">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <!-- ุณูุชู ุชุนุจุฆุฉ ุงููุญุชูู ูู js/terms-modal.js -->
      <div id="termsBody"
           class="offers-list"
           style="font-size:.85rem;line-height:1.7;">
        <p class="text-muted mb-0" data-i18n="terms.loading">ุฌุงุฑู ุชุญููู ุงูุดุฑูุท ูุงูุฃุญูุงูโฆ</p>
      </div>

      <div id="termsMeta"
           class="terms-meta small text-muted"
           style="margin-top:6px;display:none;">
        <!-- Example: ุขุฎุฑ ุชุญุฏูุซ: 2025-11-28 -->
      </div>

      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;">
        <button type="button"
                class="btn btn-light"
                data-terms-dismiss="1"
                data-i18n="terms.cancel">
          ุฅูุบุงุก
        </button>
        <button type="button"
                class="btn btn-primary"
                id="btnAcceptTerms"
                data-i18n="terms.accept">
          ุฃูุงูู ุนูู ุงูุดุฑูุท
        </button>
      </div>
    </div>
  </div>

  <!-- ========================= -->
  <!--  Footer / Navigation      -->
  <!-- ========================= -->
  <footer id="siteFooter"
          class="sticky-nav"
          aria-label="ุงูุชููู ุจูู ุงูุฎุทูุงุช"
          data-i18n-aria-label="footer.ariaLabel">
    <div class="footer-inner">
      <div class="footer-brand">
        <span data-i18n="footer.brand">
          ูุญู โข <a href="https://nahl.app" target="_blank" rel="noopener">Nahl.app</a>
        </span>
        <div class="footer-social">
          <a href="https://wa.me/966509027172"
             target="_blank"
             aria-label="WhatsApp">
            <i class="fa-brands fa-whatsapp"></i>
          </a>
          <a href="https://www.instagram.com/nahl.app?igsh=ZmljaXNncGtudjJ2"
             target="_blank"
             aria-label="Instagram">
            <i class="fa-brands fa-instagram"></i>
          </a>
          <a href="https://www.tiktok.com/@nahl.app?_t=ZS-8zgmzEQTSQW&_r=1"
             target="_blank"
             aria-label="TikTok">
            <i class="fa-brands fa-tiktok"></i>
          </a>
        </div>
      </div>

      <div class="footer-total">
        <span class="footer-total-label"
              id="footer-total-label"
              data-i18n="footer.totalLabel">
          ุฅุฌูุงูู ุงูุทูุจ:
        </span>
        <span class="footer-total-value" id="footer-total-value">โ</span>
      </div>

      <div class="footer-actions">
        <button id="footer-prev"
                type="button"
                class="btn-footer hidden"
                data-i18n="footer.prev">
          ุงูุณุงุจู
        </button>
        <button id="footer-next"
                type="button"
                class="btn-footer primary disabled"
                disabled
                data-i18n="footer.next">
          ุชุฎุทู ุงูุนุฑุถ
        </button>
      
        <button id="footer-install-btn"
                type="button"
                class="btn-footer btn-footer-icon"
                style="display:none;"
                aria-label="ุชุซุจูุช ุชุทุจูู NahlTime"
                title="ุชุซุจูุช ุชุทุจูู NahlTime"
                data-i18n-aria-label="footer.installAria"
                data-i18n-title="footer.installTitle">
          <i class="fa-solid fa-mobile-screen-button"></i>
        </button>

        <div id="footer-wait" class="">
          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          <span data-i18n="footer.wait">ูุชู ุฅุฑุณุงู ุงูุทูุจโฆ</span>
        </div>
      </div>
    </div>

  <!-- ุฒุฑ PWA ุนุงุฆู ููุงูููู/ุฃูุฏุฑููุฏ (ุงุญุชูุงุทู) -->
    <button id="installPwaBtn"
            style="display:none; position:fixed; bottom:90px; left:50%; transform:translateX(-50%);
                   z-index:9999; padding:10px 18px; border-radius:999px;
                   border:none; background:#027A93; color:#fff; font-weight:800;
                   box-shadow:0 6px 18px rgba(0,0,0,.25);"
            data-i18n="footer.installFloating">
      ๐ฒ ุชุซุจูุช ุชุทุจูู NahlTime
    </button>
  </footer>

  <!-- ========================= -->
  <!--  JS: Core Libraries       -->
  <!-- ========================= -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/js/intlTelInput.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>

  <!-- ========================= -->
  <!--  JS: App Logic (core)     -->
  <!-- ========================= -->
  <script src="app.js"></script>

  <!-- ========================= -->
  <!--  JS: Gift Workflow        -->
  <!-- ========================= -->
  <script src="js/gift.js"></script>

  <!-- ========================= -->
  <!--  JS: Terms Modal (dynamic) -->
  <!-- ========================= -->
  <script src="js/terms-modal.js"></script>

  <!-- โ Fix: Page 2 "Next" button should NOT depend on gift being "No" -->
  <script>
    $(function () {
      const $area       = $('#area');
      const $serviceCat = $('#serviceCat');
      const $service    = $('#service');
      const $giftToggle = $('#isGiftToggle');
      const $nextBtn    = $('#footer-next');

      function refreshPage2Next() {
        // ููุท ุทุจูู ุงูููุทู ุฅุฐุง ุตูุญุฉ 2 ูู ุงููุนุฑูุถุฉ ุญุงูููุง
        if (!$('#page2').hasClass('active') || !$nextBtn.length) return;

        const areaOk    = !!$area.val();
        const catOk     = !!$serviceCat.val();
        const serviceOk = !!$service.val();

        // ๐ฏ ููุงุญุธุฉ ูููุฉ:
        // ุฎูุงุฑ ุงููุฏูุฉ (ุชุดุบูู/ุฅููุงู) ูุง ูุคุซุฑ ุนูู ุชูููู ุงูุฒุฑ
        const enable = areaOk && catOk && serviceOk;

        $nextBtn.prop('disabled', !enable);
        $nextBtn.toggleClass('disabled', !enable);

        // ูู ุนูุฏู ุฏุงูุฉ ุนุงูุฉ ูู app.js ูุฅุนุงุฏุฉ ุญุณุงุจ ุงูุญุงูุฉุ ูุณุชุฏุนููุง ุจูุฏูุก
        if (typeof window.updateNextAvailability === 'function') {
          try { window.updateNextAvailability(); } catch (e) { /* ignore */ }
        }
      }

      // ุญุฏูุซ ุงูุฒุฑ ุนูุฏ ุชุบููุฑ ุงูุญููู ุงูุฑุฆูุณูุฉ ูู ุตูุญุฉ 2
      $area.on('change', refreshPage2Next);
      $serviceCat.on('change', refreshPage2Next);
      $service.on('change', refreshPage2Next);

      // ุชุบููุฑ ูุถุน ุงููุฏูุฉ ูุง ูููุน ุงูุชุงููุ ููุท ูุนูุฏ ุงูุญุณุงุจ (ููุฃูุงู)
      $giftToggle.on('change', function () {
        if (typeof window.onGiftToggleChange === 'function') {
          window.onGiftToggleChange(this.checked);
        }
        refreshPage2Next();
      });

      // ุชุดุบูู ูุจุฏุฆู
      refreshPage2Next();
    });
  </script>

  <!-- ๐ i18n + Language Toggle Logic moved to external file -->
  <script src="i18n.js"></script>

  <!-- Google Maps (after initMap is defined in app.js) -->
  <script
    defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBBHLoO038vsCovHN-SLUgAXqexlA2v0_4&libraries=places,geometry&language=ar&region=SA&callback=initMap">
  </script>
</body>
</html>
